[gd_scene load_steps=16 format=3 uid="uid://bk44v6t36uppk"]

[ext_resource type="Script" uid="uid://cb50wd0o4yo1b" path="res://scripts/tank_movement_controller.gd" id="1_mxk3p"]
[ext_resource type="PackedScene" uid="uid://cavkudnxtyvsx" path="res://assets/bullet.tscn" id="2_5hjg4"]
[ext_resource type="Script" uid="uid://bxjjla217jcbb" path="res://scripts/overhead_bar.gd" id="3_ym7mu"]

[sub_resource type="BoxShape3D" id="BoxShape3D_vaebi"]
size = Vector3(1, 1, 1.50195)

[sub_resource type="BoxMesh" id="BoxMesh_mxk3p"]
size = Vector3(1, 1, 1.5)

[sub_resource type="BoxShape3D" id="BoxShape3D_mxk3p"]
size = Vector3(1.01218, 1, 1.51746)

[sub_resource type="CylinderMesh" id="CylinderMesh_a2myn"]
height = 0.28

[sub_resource type="BoxMesh" id="BoxMesh_5hjg4"]
size = Vector3(0.15, 0.15, 1)

[sub_resource type="CylinderShape3D" id="CylinderShape3D_a2myn"]
height = 0.28067
radius = 0.5048828

[sub_resource type="SceneReplicationConfig" id="SceneReplicationConfig_mxk3p"]
properties/0/path = NodePath(".:position")
properties/0/spawn = true
properties/0/replication_mode = 1
properties/1/path = NodePath(".:rotation")
properties/1/spawn = true
properties/1/replication_mode = 1
properties/2/path = NodePath("head:rotation")
properties/2/spawn = true
properties/2/replication_mode = 1
properties/3/path = NodePath("head/head_mesh/barrel_pivot:rotation")
properties/3/spawn = true
properties/3/replication_mode = 1
properties/4/path = NodePath("health_sprite/SubViewport/health_bar:value")
properties/4/spawn = true
properties/4/replication_mode = 1
properties/5/path = NodePath("health_sprite/SubViewport/armor_bar:value")
properties/5/spawn = true
properties/5/replication_mode = 1

[sub_resource type="ViewportTexture" id="ViewportTexture_a2myn"]
viewport_path = NodePath("health_sprite/SubViewport")

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_a2myn"]
border_width_left = 2
border_width_top = 2
border_width_right = 2
border_color = Color(0, 0, 0, 1)

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_ym7mu"]
bg_color = Color(1, 0, 0, 1)

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_k2uxx"]
bg_color = Color(0.33933225, 0.33933225, 0.33933225, 1)
border_width_left = 2
border_width_right = 2
border_width_bottom = 2
border_color = Color(0.0076186024, 0.0076186024, 0.0076186024, 1)

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_wvj1w"]
bg_color = Color(1.1801987, 0.7715649, 0, 1)

[node name="Tank" type="CharacterBody3D" groups=["hit_object"]]
script = ExtResource("1_mxk3p")
Bullet = ExtResource("2_5hjg4")

[node name="movement_collider" type="CollisionShape3D" parent="."]
shape = SubResource("BoxShape3D_vaebi")

[node name="body_mesh" type="MeshInstance3D" parent="."]
mesh = SubResource("BoxMesh_mxk3p")
skeleton = NodePath("../movement_collider")

[node name="body_hitbox" type="Area3D" parent="body_mesh" groups=["hit_object"]]

[node name="CollisionShape3D" type="CollisionShape3D" parent="body_mesh/body_hitbox"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.000289917, 0, -0.000549316)
shape = SubResource("BoxShape3D_mxk3p")

[node name="head" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.649023, 0)

[node name="head_mesh" type="MeshInstance3D" parent="head"]
mesh = SubResource("CylinderMesh_a2myn")
skeleton = NodePath("")

[node name="barrel_pivot" type="Node3D" parent="head/head_mesh"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -0.491493)

[node name="barrel_mesh" type="MeshInstance3D" parent="head/head_mesh/barrel_pivot"]
transform = Transform3D(1, 0, -9.31322e-10, 0, 1, 0, 9.31322e-10, 0, 1, 0, 0.00875044, -0.351222)
mesh = SubResource("BoxMesh_5hjg4")
skeleton = NodePath("")

[node name="bullet_spawn_point" type="Marker3D" parent="head/head_mesh/barrel_pivot/barrel_mesh"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3.8376e-10, -0.00559533, -0.41206)

[node name="head_hitbox" type="Area3D" parent="head/head_mesh" groups=["hit_object"]]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 2.2586e-10, 0, 2.98051e-08)

[node name="CollisionShape3D" type="CollisionShape3D" parent="head/head_mesh/head_hitbox"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.00010681152, 0)
shape = SubResource("CylinderShape3D_a2myn")

[node name="MultiplayerSynchronizer" type="MultiplayerSynchronizer" parent="."]
replication_config = SubResource("SceneReplicationConfig_mxk3p")

[node name="fire_cooldown_timer" type="Timer" parent="."]
wait_time = 0.3
one_shot = true

[node name="health_sprite" type="Sprite3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.25231, -0.00474453)
billboard = 1
texture = SubResource("ViewportTexture_a2myn")
script = ExtResource("3_ym7mu")

[node name="SubViewport" type="SubViewport" parent="health_sprite"]
disable_3d = true
transparent_bg = true
handle_input_locally = false

[node name="health_bar" type="ProgressBar" parent="health_sprite/SubViewport"]
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -96.5
offset_top = -9.5
offset_right = 96.5
offset_bottom = 3.0
grow_horizontal = 2
grow_vertical = 2
theme_override_styles/background = SubResource("StyleBoxFlat_a2myn")
theme_override_styles/fill = SubResource("StyleBoxFlat_ym7mu")
step = 1.0
value = 100.0
show_percentage = false

[node name="armor_bar" type="ProgressBar" parent="health_sprite/SubViewport"]
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -96.0
offset_top = 3.0
offset_right = 97.0
offset_bottom = 10.0
grow_horizontal = 2
grow_vertical = 2
theme_override_styles/background = SubResource("StyleBoxFlat_k2uxx")
theme_override_styles/fill = SubResource("StyleBoxFlat_wvj1w")
step = 1.0
value = 100.0
show_percentage = false

[node name="head2" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.649023, 0)

[node name="barrel_pivot2" type="Node3D" parent="head2"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -0.491493)

[connection signal="area_entered" from="body_mesh/body_hitbox" to="." method="_on_body_hitbox_area_entered"]
[connection signal="area_entered" from="head/head_mesh/head_hitbox" to="." method="_on_head_hitbox_area_entered"]
